<div class="container">
  <h1 class="text-center text-capitalize fw-lighter mb-4">Upcoming Auctions in <%= current_company.location %></h1>
  <div class="d-flex justify-content-center row">
    <% @auctions.each do |auction| %>
      <div class="col-md-10 mb-3 shadow p-0">
      <div class="card border-0 rounded-start">
        <div class="row g-0">
          <% if auction.image.attached? %>
            <div class="col-md-4">
              <%= image_tag auction.image, class: "bd-placeholder-img rounded-top img-fluid",
                                           width: '100%', height: '100%' %>
            </div>
          <% else %>
            <div class="col-md-4">
              <svg class="bd-placeholder-img rounded-top" width="100%" height="300" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Placeholder: Image" preserveAspectRatio="xMidYMid slice" focusable="false"><title>Placeholder</title><rect width="100%" height="100%" fill="#868e96"></rect><text x="50%" y="50%" fill="#dee2e6" dy=".3em">Image</text></svg>
            </div>
          <% end %>
          <div class="col-md-8">
            <div class="card-body pt-0 d-block">
              <div class="border-bottom border-top border-primary-subtle py-2 mb-3 pb-3">
                <div class="border-bottom border-primary-subtle">
                  <h4 class="h5 fw-bold text-warning bi-alarm">
                    ENDS: <%= auction.deadline.strftime('%a %d %b %Y').upcase %>
                    <span class="h6 fw-bold float-end text-dark"><%=auction.registered?(current_company.id) %></span>
                  </h4>

                </div>
                <h2 class="card-title my-0 mb-2"><%= auction.title %></h2>
                <div class="btn-group float-end">
                  <%= link_to "#{pluralize(auction.lots.count, 'Lot')}", auction_path(auction), class: 'btn fw-bold btn-sm btn-dark' %>
                  <%= link_to 'REGISTER TO BID', '#', class: 'btn fw-bold btn-sm btn-primary' %>
                </div>
                <h4 class="h5 fw-light text-secondary-emphasis" data-deadline="<%= auction.deadline %>" id="auction-countdown">

                </h4>
              </div>
              <p class="mb-2">
                <h1>Auction Desription</h1>
                This is a wider card with supporting text below
                as a natural lead-in to additional content. This content
                is a little bit longer.
                <p>
                  This is a wider card with supporting text below
                  as a natural lead-in to additional content. This content
                  is a little bit longer.
                </p>
              <p>
                This is a wider card with supporting text below
                as a natural lead-in to additional content. This content
                is a little bit longer.
              </p>
              </p>

              <span class="text-secondary">
                <strong class="text-dark-emphasis">Additional notes: </strong>
                <p><%= auction.notes %></p>
              </span>

              <a href="<%= company_profile_path %>" class="float-end mb-3 text-decoration-none d-flex">
                <svg class="bd-placeholder-img rounded me-1" width="25" height="25"
                     xmlns="http://www.w3.org/2000/svg" aria-hidden="true"
                     preserveAspectRatio="xMidYMid slice" focusable="false">
                  <rect width="100%" height="100%" fill="#007aff"></rect>
                  <!-- Create a text element for the initial letter -->
                  <text x="50%" y="50%" fill="white" dy=".3em" font-weight="bold" font-size="18" text-anchor="middle">
                    <%= auction.company.name[0] %>
                  </text>
                </svg>
                <strong class="h5 fw-bold m-auto"><%= auction.company.name %></strong>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <% end %>
  </div>
</div>

<script>
    // Function to update countdown for each auction
    function updateCountdown(element, deadlineTimestamp) {
        var now = new Date();
        var timeRemaining = deadlineTimestamp - now;

        if (timeRemaining > 0) {
            var days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
            var hours = Math.floor((timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            var minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
            var seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);

            element.innerHTML =
                "Time Remaining: " + days + "D " + hours + "H " + minutes + "M " + seconds + "s";
        } else {
            element.innerHTML = "Auction has ended";
        }
    }

    // Loop through each countdown element
    document.querySelectorAll("#auction-countdown").forEach(function (element) {
        var deadlineTimestamp = new Date(element.getAttribute("data-deadline"));
        updateCountdown(element, deadlineTimestamp);

        // Update countdown every second
        setInterval(function () {
            updateCountdown(element, deadlineTimestamp);
        }, 1000);
    });
</script>